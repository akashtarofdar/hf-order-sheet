<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>HF Sublimation - Universal Order System</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@500;700&family=Teko:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #E31E24; --dark: #1e272e; --highlight: #fff9c4; }
        body { font-family: 'Hind Siliguri', sans-serif; background: #f0f2f5; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .admin-panel { background: white; padding: 25px; border-radius: 12px; width: 100%; max-width: 950px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 30px; border-top: 8px solid var(--primary); }
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .input-box label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        .input-box input[type="text"], .input-box input[type="date"], .input-box textarea, .input-box select { width: 100%; padding: 10px; border: 1.5px solid #ddd; border-radius: 6px; box-sizing: border-box; font-family: inherit; }
        
        /* Checkbox Style */
        .checkbox-group { display: flex; align-items: center; gap: 10px; background: #f9f9f9; padding: 10px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; }
        .checkbox-group input { width: 20px; height: 20px; cursor: pointer; }
        .checkbox-group label { margin: 0; cursor: pointer; color: var(--primary); }

        table.entry { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table.entry th { background: var(--dark); color: white; padding: 10px; font-size: 14px; }
        table.entry td { border: 1px solid #eee; padding: 5px; text-align: center; }
        table.entry input { width: 55px; text-align: center; border: 1px solid #ddd; }

        /* A4 Sheet Styles */
        #a4-eco-sheet {
            width: 794px; height: 1123px; background: white; 
            padding: 25px; 
            display: flex; flex-direction: column; box-sizing: border-box;
            border: 1px solid #ddd; position: absolute; left: -9999px;
        }
        .active-preview #a4-eco-sheet { position: relative; left: 0; margin-top: 20px; box-shadow: 0 0 20px rgba(0,0,0,0.1); }

        /* Header Compacted */
        .sheet-header { display: flex; justify-content: space-between; border-bottom: 3px solid var(--primary); padding-bottom: 8px; margin-bottom: 12px; }
        .brand { font-size: 38px; font-weight: 900; color: var(--primary); font-family: 'Teko', sans-serif; line-height: 0.9; }
        .invoice-tag { background: var(--dark); color: white; padding: 3px 12px; border-radius: 4px; font-family: 'Teko', sans-serif; font-size: 18px; margin-top: 5px; display: inline-block; }

        .main-body { display: grid; grid-template-columns: 230px 1fr; gap: 20px; flex-grow: 1; overflow: hidden; }
        .side-col { background: #fdfdfd; padding: 10px; border-radius: 8px; border: 1px solid #f0f0f0; display: flex; flex-direction: column; }
        
        /* Requirement Box - Updated to include Specs */
        .req-highlight-box { background: var(--highlight); border: 2px solid #fbc02d; padding: 8px; border-radius: 5px; margin-bottom: 12px; min-height: 80px; }
        .req-title { font-size: 13px; font-weight: bold; color: #d32f2f; text-decoration: underline; margin-bottom: 5px; display: block; }
        .req-text { font-size: 13px; color: #000; font-weight: 700; line-height: 1.3; word-wrap: break-word; }
        
        /* Specs Badge Style inside Req Box */
        .spec-row { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 8px; border-bottom: 1px dashed #f9a825; padding-bottom: 5px; }
        .spec-badge { font-size: 11px; background: white; border: 1px solid #fbc02d; padding: 2px 5px; border-radius: 3px; font-weight: bold; color: #333; }
        .badge-highlight { background: var(--primary); color: white; border-color: var(--primary); }
        .badge-dark { background: var(--dark); color: white; border-color: var(--dark); }

        .label-red { font-size: 11px; font-weight: bold; color: white; background: var(--primary); padding: 2px 8px; border-radius: 3px; margin-bottom: 3px; display: inline-block; text-transform: uppercase; }
        .stat-val { font-family: 'Teko', sans-serif; font-size: 24px; color: var(--dark); margin-bottom: 5px; line-height: 1; }

        .image-container { width: 100%; border: 1px dashed #ccc; border-radius: 8px; background: #fafafa; display: flex; align-items: center; justify-content: center; overflow: hidden; position: relative; }
        
        /* Size Control - List Box is kept BIG */
        .design-box { height: 160px; margin-bottom: 10px; }
        .list-box { height: 640px; } 
        
        .image-container img { max-width: 100%; max-height: 100%; object-fit: contain; }

        .footer { margin-top: auto; border-top: 1px solid #eee; padding-top: 10px; display: flex; justify-content: space-between; align-items: flex-end; font-size: 12px; color: #777; }
        .designer-highlight { color: #333; font-size: 14px; border-bottom: 2px solid var(--primary); padding-bottom: 2px; }
        .footer a { color: var(--primary); text-decoration: none; font-weight: bold; }
        .dl-btn { background: var(--primary); color: white; border: none; padding: 18px; font-size: 20px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 20px; }
    </style>
</head>
<body class="active-preview">

<div class="admin-panel">
    <h2 style="text-align:center; color:var(--primary);">SUBLIMATION ORDER SHEET Generator</h2>
    
    <div class="grid-layout">
        <div class="input-box"><label>ইনভয়েস নম্বর:</label><input type="text" id="inInvoice" placeholder="HF-101" oninput="upd()"></div>
        <div class="input-box"><label>ফাইল নাম:</label><input type="text" id="fileName" placeholder="File Name" oninput="upd()"></div>
        <div class="input-box"><label>অর্ডার তারিখ:</label><input type="date" id="inDate" oninput="upd()"></div>
    </div>

    <div class="grid-layout">
        <div class="input-box">
            <label>অর্ডার টাইপ (Top):</label>
            <select id="topType" onchange="upd()">
                <option value="Jersey">Jersey</option>
                <option value="Tracksuit">Tracksuit</option>
            </select>
        </div>
        <div class="input-box">
            <label>অর্ডার টাইপ (Bottom):</label>
            <select id="bottomType" onchange="upd()">
                <option value="Pant">Pant</option>
                <option value="Trouser">Trouser</option>
            </select>
        </div>
        <div class="input-box"><label>ডেলিভারি তারিখ:</label><input type="date" id="inDel" oninput="upd()"></div>
    </div>

    <div class="grid-layout" style="background: #e3f2fd; padding: 10px; border-radius: 6px; border: 1px solid #90caf9;">
        <div class="input-box">
            <label style="color:var(--primary)">কাপড় (Fabric):</label>
            <select id="inFabric" onchange="upd()">
                <option value="">-- সিলেক্ট করুন --</option>
                <option value="পিপি কাপড়">পিপি কাপড় (PP)</option>
                <option value="চিনিগুড়া / সুগার মেশ">চিনিগুড়া / সুগার মেশ</option>
                <option value="বক্স মেশ / বল মেশ / থাই মেশ">বক্স মেশ / বল মেশ / থাই মেশ</option>
                <option value="হানিকম্ব কাপড়">হানিকম্ব কাপড়</option>
                <option value="হানিকম্ব মেশ কাপড়">হানিকম্ব মেশ কাপড়</option>
                <option value="লিফ জেকোয়ার্ট কাপড়">লিফ জেকোয়ার্ট কাপড়</option>
                <option value="ব্রাশ জেকোয়ার্ট কাপড়">ব্রাশ জেকোয়ার্ট কাপড়</option>
                <option value="রোলেক্স কাপড়">রোলেক্স কাপড়</option>
            </select>
        </div>
        <div class="input-box">
            <label style="color:var(--primary)">গলা (Collar):</label>
            <select id="inCollar" onchange="upd()">
                <option value="">-- সিলেক্ট করুন --</option>
                <option value="কলার (Collar)">কলার (Collar)</option>
                <option value="গোল গলা (Round)">গোল গলা (Round)</option>
                <option value="ভি কলার (V-Collar)">ভি কলার (V-Collar)</option>
                <option value="ভ্যান কলার (Van Collar)">ভ্যান কলার (Van Collar)</option>
                <option value="পাঞ্জাবী কলার (Panjabi)">পাঞ্জাবী কলার (Panjabi)</option>
                <option value="ভি গলা (V-Neck)">ভি গলা (V-Neck)</option>
                <option value="ক্রোস ভি গলা (Cross V)">ক্রোস ভি গলা (Cross V)</option>
            </select>
        </div>
        <div class="input-box">
            <label style="color:var(--primary)">হাতা (Sleeve):</label>
            <select id="inSleeve" onchange="upd()">
                <option value="">-- সিলেক্ট করুন --</option>
                <option value="হাফ হাতা">হাফ হাতা (Half)</option>
                <option value="ফুল হাতা">ফুল হাতা (Full)</option>
                <option value="রেগ লাইন হাফ">রেগ লাইন হাফ (Raglan Half)</option>
                <option value="রেগ লাইন ফুল">রেগ লাইন ফুল (Raglan Full)</option>
                <option value="মেগি হাতা">মেগি হাতা (Maggy)</option>
            </select>
        </div>
    </div>

    <div class="grid-layout">
        <div class="checkbox-group" onclick="toggleCheck('checkRib')">
            <input type="checkbox" id="checkRib" onchange="upd()">
            <label for="checkRib">হাতে রিপ বা কফ (Hand Rib/Cuff)</label>
        </div>
        <div class="checkbox-group" onclick="toggleCheck('checkPlacket')">
            <input type="checkbox" id="checkPlacket" onchange="upd()">
            <label for="checkPlacket">ডাবল প্লাকেট (Double Placket)</label>
        </div>
    </div>

    <div class="grid-layout">
        <div class="input-box"><label>কাস্টমার নাম:</label><input type="text" id="inName" oninput="upd()"></div>
        <div class="input-box"><label>ডিজাইনার নাম:</label><input type="text" id="inDesigner" oninput="upd()"></div>
    </div>

    <div class="input-box" style="margin-bottom: 15px;">
        <label style="color:red">অন্যান্য রিকোয়ারমেন্ট (Note):</label>
        <textarea id="inReq" rows="3" placeholder="অন্য কোনো বিশেষ নির্দেশনাবলী থাকলে এখানে লিখুন..." oninput="upd()"></textarea>
    </div>

    <table class="entry">
        <thead>
            <tr>
                <th>সাইজ</th>
                <th>মোট</th>
                <th>Full (F)</th>
                <th>Half (H)</th>
                <th id="tableBottomHead">Pant (P)</th>
            </tr>
        </thead>
        <tbody id="rows"></tbody>
    </table>

    <div class="grid-layout" style="margin-top:20px">
        <div class="input-box"><label>ডিজাইন ছবি (Small Preview):</label><input type="file" accept="image/*" onchange="previewImg(event, 'outDesignImg')"></div>
        <div class="input-box"><label>নাম-নাম্বার লিস্ট ছবি (Large View):</label><input type="file" accept="image/*" onchange="previewImg(event, 'outListImg')"></div>
    </div>
    <button class="dl-btn" onclick="downloadPDF()">Generate & Print PDF</button>
</div>

<div id="a4-eco-sheet">
    <div class="sheet-header">
        <div>
            <div class="brand">HF SUBLIMATION</div>
            <div style="font-size: 11px; color: #666; font-weight: bold;">PREMIUM SPORTSWEAR MANUFACTURER</div>
            <div class="invoice-tag">INV: <span id="outInvoice">---</span></div>
        </div>
        <div style="text-align: right; font-size: 12px; line-height: 1.4;">
            <div><strong>DATE:</strong> <span id="outDate">---</span></div>
            <div><strong>DELIVERY:</strong> <span id="outDel">---</span></div>
            <div><strong>FILE:</strong> <span id="outFile">---</span></div>
        </div>
    </div>

    <div style="background:var(--dark); color:white; padding:6px; text-align:center; margin-bottom:12px; font-weight:bold; font-size: 18px; border-radius: 4px; text-transform: uppercase;">
        CUSTOMER: <span id="outName">---</span>
    </div>

    <div class="main-body">
        <div class="side-col">
            <div class="label-red">Requirement / বিশেষ নির্দেশ</div>
            
            <div class="req-highlight-box">
                <span class="req-title">SPECIFICATIONS:</span>
                
                <div class="spec-row">
                    <div class="spec-badge" id="dispFabric">No Fabric</div>
                    <div class="spec-badge" id="dispCollar">No Collar</div>
                    <div class="spec-badge" id="dispSleeve">No Sleeve Info</div>
                    <div class="spec-badge badge-dark" id="dispRib" style="display:none;">HAND RIB/CUFF</div>
                    <div class="spec-badge badge-highlight" id="dispPlacket" style="display:none;">DOUBLE PLACKET</div>
                </div>

                <span class="req-title">NOTE:</span>
                <div id="outReq" class="req-text">নির্দেশনা নেই</div>
            </div>

            <div class="label-red">Top Type: <span id="outTopLabel">Jersey</span></div>
            <div class="stat-val">F: <span id="totF">0</span> | H: <span id="totH">0</span></div>
            
            <div class="label-red">Size Breakup</div>
            <div id="outSizes" style="font-family:'Teko'; font-size:19px; margin-bottom: 8px; line-height:1.1;"></div>

            <div style="margin-top:auto;">
                <div class="label-red">Final Quantity</div>
                <div class="stat-val" style="font-size:32px; color:var(--primary); margin-bottom:0;"><span id="outTopFinal">JERSEY</span>: <span id="totJ">0</span></div>
                <div class="stat-val" style="font-size:24px; color:#555;"><span id="outBottomFinal">PANT</span>: <span id="totP">0</span></div>
            </div>
        </div>

        <div class="content-col">
            <div class="image-container design-box">
                <img id="outDesignImg" src="" alt="Design Preview">
            </div>
            <div class="image-container list-box">
                <img id="outListImg" src="" alt="Name List will appear here large">
            </div>
        </div>
    </div>

    <div class="footer">
        <div>
            <span style="font-size: 10px; text-transform: uppercase;">Design Prepared By:</span><br>
            <strong class="designer-highlight" id="outDesigner">---</strong>
        </div>
        <div style="text-align: right;">
            <span style="font-size: 9px;">System developed by:</span><br>
            <a href="https://www.facebook.com/AbuSiddikTarafdar" target="_blank">Skyme</a>
        </div>
    </div>
</div>

<script>
    const sizes = ["6XL", "5XL", "4XL", "3XL", "XXL", "XL", "L", "M", "S", "BABY"];
    const tbody = document.getElementById('rows');
    sizes.forEach(s => {
        tbody.innerHTML += `<tr><td><strong>${s}</strong></td><td><input type="number" class="v-total" value="0" oninput="upd()"></td><td><input type="number" class="v-f" value="0" oninput="upd()"></td><td><input type="number" class="v-h" value="0" oninput="upd()"></td><td><input type="number" class="v-p" value="0" oninput="upd()"></td></tr>`;
    });

    function toggleCheck(id) {
        // Helper to let user click the whole box to check
        // Handled by label click usually, but extra safety
    }

    function formatDate(dateStr) {
        if(!dateStr) return "---";
        const date = new Date(dateStr);
        return `${String(date.getDate()).padStart(2, '0')}/${String(date.getMonth() + 1).padStart(2, '0')}/${String(date.getFullYear()).slice(-2)}`;
    }

    function upd() {
        const topType = document.getElementById('topType').value;
        const bottomType = document.getElementById('bottomType').value;
        
        // New Specs Inputs
        const fabric = document.getElementById('inFabric').value;
        const collar = document.getElementById('inCollar').value;
        const sleeve = document.getElementById('inSleeve').value;
        const isRib = document.getElementById('checkRib').checked;
        const isPlacket = document.getElementById('checkPlacket').checked;

        document.getElementById('tableBottomHead').innerText = `${bottomType} (P)`;
        document.getElementById('outTopLabel').innerText = topType;
        document.getElementById('outTopFinal').innerText = topType === "Jersey" ? "JERSEY" : "TRACKSUIT";
        document.getElementById('outBottomFinal').innerText = bottomType === "Pant" ? "PANT" : "TROUSER";

        document.getElementById('outInvoice').innerText = document.getElementById('inInvoice').value || "---";
        document.getElementById('outFile').innerText = document.getElementById('fileName').value || "---";
        document.getElementById('outDate').innerText = formatDate(document.getElementById('inDate').value);
        document.getElementById('outDel').innerText = formatDate(document.getElementById('inDel').value);
        document.getElementById('outName').innerText = document.getElementById('inName').value || "---";
        document.getElementById('outDesigner').innerText = document.getElementById('inDesigner').value || "---";
        document.getElementById('outReq').innerText = document.getElementById('inReq').value || "নির্দেশনা নেই";

        // Update Specs Display
        const elFab = document.getElementById('dispFabric');
        elFab.innerText = fabric || "কাপড় নেই";
        elFab.style.display = fabric ? "block" : "none";

        const elCol = document.getElementById('dispCollar');
        elCol.innerText = collar || "গলা নেই";
        elCol.style.display = collar ? "block" : "none";

        const elSlv = document.getElementById('dispSleeve');
        elSlv.innerText = sleeve || "হাতা নেই";
        elSlv.style.display = sleeve ? "block" : "none";

        // Checkboxes display logic
        document.getElementById('dispRib').style.display = isRib ? "block" : "none";
        document.getElementById('dispPlacket').style.display = isPlacket ? "block" : "none";

        let tf=0, th=0, tp=0, tj=0, sizeHtml="";
        sizes.forEach((s, i) => {
            let total = parseInt(document.querySelectorAll('.v-total')[i].value) || 0;
            let f = parseInt(document.querySelectorAll('.v-f')[i].value) || 0;
            let h = parseInt(document.querySelectorAll('.v-h')[i].value) || 0;
            let p = parseInt(document.querySelectorAll('.v-p')[i].value) || 0;
            if(total > 0 || p > 0) sizeHtml += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #eee;"><span>${s}</span> <span>${total}</span></div>`;
            tf+=f; th+=h; tp+=p; tj+=total;
        });
        document.getElementById('outSizes').innerHTML = sizeHtml;
        document.getElementById('totF').innerText = tf; document.getElementById('totH').innerText = th;
        document.getElementById('totJ').innerText = tj; document.getElementById('totP').innerText = tp;
    }

    function previewImg(e, outId) {
        if(!e.target.files[0]) return;
        let r = new FileReader();
        r.onload = () => { document.getElementById(outId).src = r.result; }
        r.readAsDataURL(e.target.files[0]);
    }

    async function downloadPDF() {
        const area = document.getElementById('a4-eco-sheet');
        const invNo = document.getElementById('inInvoice').value || "Inv";
        const custName = document.getElementById('inName').value || "Order";
        const safeFileName = `${invNo}_${custName}`.replace(/[/\\?%*:|"<>]/g, '-');

        html2canvas(area, { scale: 3, useCORS: true }).then(canvas => {
            const imgData = canvas.toDataURL('image/jpeg', 0.95);
            const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
            pdf.addImage(imgData, 'JPEG', 0, 0, 210, 297);
            window.open(pdf.output('bloburl'), '_blank');
            pdf.save(`${safeFileName}.pdf`);
        });
    }
    upd();
</script>
</body>
</html>
